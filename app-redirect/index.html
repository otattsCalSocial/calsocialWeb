<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Open Event Details</title>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const uid = window.location.pathname.split('/').pop();
  
      if (!uid) {
        alert('Error: UID is missing in the URL. Unable to open the event.');
        return;
      }
  
      const deepLink = `calsocial://event/${uid}`;
      const universalLink = `https://cal.social/event/${uid}`;
      const appStoreURL = 'https://apps.apple.com/app/calsocial/id6738835548';
      const playStoreURL = 'https://play.google.com/store/apps/details?id=social.cal.calsocial';
  
      const isInAppBrowser = () => {
        const ua = navigator.userAgent || navigator.vendor || window.opera;
        return /FBAN|FBAV|Instagram|Messenger/i.test(ua);
      };
  
      const openApp = (link) => {
        const win = window.open(link, '_self');
        if (!win) {
          alert('Could not open the link. Please try in another browser.');
        }
      };
  
      if (isInAppBrowser()) {
        document.body.innerHTML = `
          <p>Please tap the three dots in the top right corner and choose "Open in Browser" to view this event.</p>
        `;
        return;
      }
  
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
  
      if (/iPhone|iPad|iPod/i.test(userAgent)) {
        openApp(deepLink);
        setTimeout(() => {
          openApp(appStoreURL);
        }, 1500);
      } else if (/Android/i.test(userAgent)) {
        const intentLink = `intent://event/${uid}#Intent;scheme=calsocial;package=social.cal.calsocial;S.browser_fallback_url=${encodeURIComponent(universalLink)};end;`;
        openApp(intentLink);
        setTimeout(() => {
          openApp(playStoreURL);
        }, 1500);
      } else {
        openApp(universalLink);
      }
    });
  </script>
</head>
<body>
  <p>Opening CalSocial to Event Details...</p>
</body>
</html>
