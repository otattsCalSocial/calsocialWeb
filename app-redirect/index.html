<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Open Event Details</title>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const uid = window.location.pathname.split('/').pop();
      if (!uid) {
        alert('Error: UID is missing in the URL.');
        return;
      }

      const deepLink = `calsocial://event/${uid}`;
      const universalLink = `https://cal.social/event/${uid}`;
      const appStoreURL = 'https://apps.apple.com/app/calsocial/id6738835548';
      const playStoreURL = 'https://play.google.com/store/apps/details?id=social.cal.calsocial';

      function openApp() {
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          // Try universal link first
          window.location.href = universalLink;
          
          setTimeout(() => {
            // If universal link fails, try deep link
            window.location.href = deepLink;
            
            setTimeout(() => {
              window.location.href = appStoreURL;
            }, 1000);
          }, 500);
        } else if (/Android/i.test(navigator.userAgent)) {
          const iframe = document.createElement('iframe');
          iframe.style.display = 'none';
          document.body.appendChild(iframe);
          
          iframe.src = deepLink;
          
          setTimeout(() => {
            document.body.removeChild(iframe);
            window.location.href = playStoreURL;
          }, 1000);
        } else {
          window.location.href = universalLink;
        }
      }

      openApp();
    });
  </script>
</head>
<body>
  <p>Opening CalSocial...</p>
</body>
</html>