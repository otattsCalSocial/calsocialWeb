<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting to CalSocial</title>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var appStoreURL = 'https://apps.apple.com/app/calsocial/id6738835548';
      var playStoreURL = 'https://play.google.com/store/apps/details?id=com.yourcompany.calsocial';
      var fallbackTimeout;

      function redirectToStore() {
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        if (/iPhone|iPad|iPod/i.test(userAgent)) {
          window.location.replace(appStoreURL);
        } else if (/Android/i.test(userAgent)) {
          window.location.replace(playStoreURL);
        } else {
          window.location.replace('https://cal.social');
        }
      }

      // Get the event ID from the URL if present
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get('event') || '';
      
      // Construct the deep link
      const deepLink = `calsocial://event/${eventId}`;

      // For iOS 9+
      if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
        window.location.replace(deepLink);
        fallbackTimeout = setTimeout(redirectToStore, 2000);
      } 
      // For Android
      else if (navigator.userAgent.match(/Android/i)) {
        window.location.href = deepLink;
        fallbackTimeout = setTimeout(redirectToStore, 2000);
      }
      // For all other platforms
      else {
        redirectToStore();
      }

      window.addEventListener('pagehide', function() {
        clearTimeout(fallbackTimeout);
      });

      window.addEventListener('blur', function() {
        clearTimeout(fallbackTimeout);
      });
    });
  </script>
</head>
<body>
  <p>Opening CalSocial...</p>
</body>
</html>