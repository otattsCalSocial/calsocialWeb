<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting to CalSocial</title>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const appStoreURL = 'https://apps.apple.com/app/calsocial/id6738835548';
      const playStoreURL = 'https://play.google.com/store/apps/details?id=com.yourcompany.calsocial';
  
      function redirectToStore() {
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;
        if (/iPhone|iPad|iPod/i.test(userAgent)) {
          displayErrorMessage();
          setTimeout(() => {
            window.location.replace(appStoreURL);
          }, 3000);
        } else if (/Android/i.test(userAgent)) {
          window.location.replace(playStoreURL);
        } else {
          window.location.replace('https://cal.social');
        }
      }
  
      const urlParams = new URLSearchParams(window.location.search);
      const eventId = urlParams.get('event') || '';
      const deepLink = `calsocial://event/${eventId}`;
      let fallbackTimeout;
  
      function displayErrorMessage() {
        const errorMessage = document.createElement('p');
        errorMessage.innerText = "It seems CalSocial is not installed. Redirecting to the App Store...";
        errorMessage.style.color = "red";
        errorMessage.style.fontWeight = "bold";
        document.body.appendChild(errorMessage);
      }
  
      if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = deepLink;
        document.body.appendChild(iframe);
  
        fallbackTimeout = setTimeout(() => {
          displayErrorMessage();
          redirectToStore();
        }, 3000);
      } else if (/Android/i.test(navigator.userAgent)) {
        window.location.href = deepLink;
        fallbackTimeout = setTimeout(redirectToStore, 3000);
      } else {
        redirectToStore();
      }
  
      window.addEventListener('pagehide', function () {
        clearTimeout(fallbackTimeout);
      });
  
      window.addEventListener('blur', function () {
        clearTimeout(fallbackTimeout);
      });
    });
  </script>
</head>
<body>
  <p>Opening CalSocial...</p>
</body>
</html>
